<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>吹き出し文字入れ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    margin: 0;
    padding: 12px;
    background: #111;
    color: #fff;
    font-family: system-ui, sans-serif;
    text-align: center;
  }
  input, button {
    font-size: 16px;
    padding: 8px;
    margin: 4px;
  }
  canvas {
    width: 100%;
    max-width: 420px; /* スマホ見やすさ */
    height: auto;
    background: #000;
  }
</style>
</head>
<body>

<input id="text" placeholder="吹き出しの文字">
<button onclick="render()">反映</button>
<button onclick="download()">保存</button>

<br><br>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// 元画像
const img = new Image();
img.src = "face.jpeg";
img.onload = () => {
  canvas.width = img.width;   // 1080
  canvas.height = img.height; // 1920
  render();
};

// ===== 吹き出し文字エリア（この画像用・決め打ち）=====
const bubble = {
  x: 120,        // 左
  y: 520,        // 上
  width: 840,    // 横幅
  fontSize: 44,
  lineHeight: 56
};
// ======================================================

function drawText(text) {
  ctx.fillStyle = "#000";
  ctx.font = `${bubble.fontSize}px sans-serif`;
  ctx.textBaseline = "top";

  let x = bubble.x;
  let y = bubble.y;
  let line = "";

  for (const ch of text) {
    const test = line + ch;
    if (ctx.measureText(test).width > bubble.width) {
      ctx.fillText(line, x, y);
      line = ch;
      y += bubble.lineHeight;
    } else {
      line = test;
    }
  }
  if (line) ctx.fillText(line, x, y);
}

function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(img, 0, 0);
  drawText(document.getElementById("text").value);
}

function download() {
  canvas.toBlob(blob => {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "result.png";
    a.click();
    URL.revokeObjectURL(a.href);
  });
}
</script>

</body>
</html>
